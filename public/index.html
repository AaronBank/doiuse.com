<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="doiuse.com: Lint your CSS againt autoprefixer-like browser queries.">
    <script async="" src="//www.google-analytics.com/analytics.js"></script>
    <title>doiuse...?</title>
    <style id="anti-fouc">
    </style>
    <link rel="stylesheet" href="/vendor/atebits.css" media="screen" title="spinner" charset="utf-8">
  </head>
  <body class="fouc">
    <!--[if lt IE 10]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <header>
      <h1>
        Do I use <small style="position: relative; top: .02em;">$</small>hit that breaks in...
        <nobr><input type="text" name="browsers" value="" placeholder="> 1%,last 2 versions,Firefox ESR,Opera 12.1">?</nobr>
        <button disabled>&rarr; Tell me.</button>
      </h1>
    </header>
    
    <section>
      <label>
        Paste URL:
        <input type="text" name="url" value="" placeholder="http://www.w3.org/standards/">
      </label>
      
      <aside class="loading">
        <div class="atebits">Loading...</div>
      </aside>
      <section class="results-view">
        <table>
          <thead>
            <tr>
              <td>
                Feature
              </td>
              <td>
                Browsers Lacking Support
              </td>
            </tr>
          </thead>
          <tbody id="results">
          </tbody>
        </table>
      </section>
      
      <label>
        Paste HTML or CSS:
        <textarea name="css" rows="15" cols="40"></textarea>
      </label>
    </section>
    
    <footer>
      <div class="by">
        By <a href="http://anand.codes">Anand Thakker</a>.<br>
        <a href="https://github.com/anandthakker/doiuse.com">(source)</a>
        <a href="https://github.com/anandthakker/doiuse.com/issues">(issues)</a>
      </div>
      <div class="credits">
        <p>Built with <a href="https://github.com/anandthakker/doiuse">doiuse</a>,
          owing much to:</p>
        <ul>
          <li><a href="http://caniuse.com">caniuse.com</a></li>
          <li><a href="https://github.com/postcss/autoprefixer">autoprefixer</a></li>
          <li><a href="https://github.com/postcss">postcss</a></li>
          <li><a href="https://github.com/substack/browserify">browserify</a></li>
        </ul>
        <p>Delightful "atebits" spinner by <a href="https://github.com/jlong/css-spinners">Justin Long and Julia Elman</a>.</p>
      </div>
    </footer>
  </body>
  
  <script src="bundle.js"></script>
  <script charset="utf-8">

    var doiuse = require('doiuse-browser');

    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('.fouc').classList.remove('fouc');
      
      var options = {};
      var button = document.querySelector('button');
      var loading = document.querySelector('.loading');
      var results = document.querySelector('#results');
      var resultsView = document.querySelector('.results-view');

      // initialize classes
      if(results.children.length > 0) resultsView.classList.add('show');
      
      
      // bind input element values to options object.
      doiuse.bindElement(options, ['browsers', 'url', 'css'], function(el, val, prop) {
        var url = options.url.trim().length;
        var css = options.css.trim().length
        if(url ? !css : css) // xor
          button.removeAttribute('disabled');
        else
          button.setAttribute('disabled', true);
      });
      
      // handle click & enter key in url field
      button.addEventListener('click', fetch);
      document.querySelector('input[name="url"]')
        .addEventListener('keyup', function(e) { if(e.keyCode === 13) fetch(); });

      function fetch() {
        if(button.getAttribute('disabled')) return;
        resultsView.classList.remove('show');
        loading.classList.add('show');
        doiuse.process(options, update(options));
      }
      
      function update(options, skipHistory) {
        return function(err, response) {
          if(err) {
            console.error(err);
            // TODO: betterness.
          }
          else if(options.url === response.options.url &&
            options.browsers === response.options.browsers) {
            results.innerHTML = response.results;
            resultsView.classList.add('show');
            loading.classList.remove('show');

            document.querySelector('[name="url"]').value = options.url
            document.querySelector('[name="css"]').value = options.css
            document.querySelector('[name="browsers"]').value = options.browsers
            
            if(!skipHistory) saveState(response);
          }
        }
      }
      
      function saveState(response) {
        if((response.options.url || '').trim().length > 0) {
          window.history.pushState(response, '', 
          '/?url=' + response.options.url + '&browsers=' + (response.options.browsers || ''))
        }
      }
      
      window.addEventListener('popstate', function(event) {
        options = event.state.options;
        update(options, true)(null, event.state);
      });
      
    }); // DOMContentLoaded
    
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-57788588-1', 'auto');
    ga('send', 'pageview');
  </script>
</html>
