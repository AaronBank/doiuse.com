<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="doiuse.com: Lint your CSS againt autoprefixer-like browser queries.">
    <script async="" src="//www.google-analytics.com/analytics.js"></script>
    <title>doiuse...?</title>
    <style id="anti-fouc">
    </style>
    <link rel="stylesheet" href="/vendor/atebits.css" media="screen" title="spinner" charset="utf-8">
  </head>
  <body class="fouc">
    <!--[if lt IE 10]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <header>
      <h1>
        Do I use <small style="position: relative; top: .02em;">$</small>hit that breaks in...
        <nobr><input type="text" name="browsers" value="" placeholder="> 1%,last 2 versions,Firefox ESR,Opera 12.1">?</nobr>
        <button disabled>&rarr; Tell me.</button>
      </h1>
    </header>
    
    <section>
      <label>
        Paste URL:
        <input type="text" name="url" value="" placeholder="http://www.w3.org/standards/">
      </label>
      
      <aside class="loading">
        <div class="atebits">Loading...</div>
      </aside>
      <section class="results-view">
        <header>
          <div class="feature">
            Feature
          </div>
          <div class="browsers">
            Browsers Missing Support
          </div>
          <div class="source">
            Example (from your source)
          </div>
        </header>
        <ul id="results">
        </ul>
      </section>
      
      <label>
        Paste HTML or CSS:
        <textarea name="css" rows="15" cols="40"></textarea>
      </label>
    </section>
    
    <footer>
      <div class="by">
        By <a href="http://anand.codes">Anand Thakker</a>.<br>
        <a href="https://github.com/anandthakker/doiuse.com">(source)</a>
        <a href="https://github.com/anandthakker/doiuse.com/issues">(issues)</a>
      </div>
      <div class="credits">
        <p>Built with <a href="https://github.com/anandthakker/doiuse">doiuse</a>,
          owing much to:</p>
        <ul>
          <li><a href="http://caniuse.com">caniuse.com</a></li>
          <li><a href="https://github.com/postcss/autoprefixer">autoprefixer</a></li>
          <li><a href="https://github.com/postcss">postcss</a></li>
          <li><a href="https://github.com/substack/browserify">browserify</a></li>
        </ul>
        <p>Delightful "atebits" spinner by <a href="https://github.com/jlong/css-spinners">Justin Long and Julia Elman</a>.</p>
        <p>Syntax highlighting by <a href="http://prismjs.com/">PrismJS</a>.</p>
      </div>
    </footer>
  </body>
  
  <script src="bundle.js"></script>
  <script id="form-data" charset="utf-8">
    var options = {};
  </script>
  <script charset="utf-8">
    var doiuse = require('doiuse-browser'),
      $ = document.querySelector.bind(document);

    document.addEventListener('DOMContentLoaded', function() {
      $('.fouc').classList.remove('fouc');
      
      // elements
      var button = $('button');
      var loading = $('.loading');
      var resultsView = $('.results-view');
      var results = $('#results');
      var url = $('[name="url"]')
      var browsers = $('[name="browsers"]')
      var css = $('[name="css"]')
      

      // initialize classes
      if(results.children.length > 0) resultsView.classList.add('show');

      // handle click & enter key field
      button.addEventListener('click', fetch);
      url.addEventListener('keyup', function(e) { if(e.keyCode === 13) fetch(); });
      browsers.addEventListener('keyup', function(e) { if(e.keyCode === 13) fetch(); });

      [ url, css, browsers ].forEach(function(el) {
        el.addEventListener('keyup', updateOptions);
      })

      function updateOptions() {
        options.url = url.value.trim();
        options.css = css.value.trim();
        options.browsers = browsers.value.trim();
        
        // button state
        if(options.url.length ? !options.css.length : options.css.length) // xor
          button.removeAttribute('disabled');
        else
          button.setAttribute('disabled', true);
      }

      function fetch() {
        if(button.getAttribute('disabled')) return;
        resultsView.classList.remove('show');
        loading.classList.add('show');
        doiuse.process(options, update(options));
      }
      
      function update(options, skipHistory) {
        return function renderResponse(err, response) {
          if(err) {
            console.error(err);
            // TODO: betterness.
          }
          else if(options.url === response.options.url &&
            options.browsers === response.options.browsers) {
            results.innerHTML = response.results;
            resultsView.classList.add('show');
            loading.classList.remove('show');

            url.value = options.url
            css.value = options.css
            browsers.value = options.browsers
            
            if(!skipHistory) saveState(response);
          }
        }
      }
      
      function saveState(response) {
        if((response.options.url || '').trim().length > 0) {
          window.history.pushState(response, '', 
          '/?url=' + response.options.url + '&browsers=' + (response.options.browsers || ''))
        }
      }
      
      window.addEventListener('popstate', function(event) {
        options = event.state.options;
        update(options, true)(null, event.state);
      });
      
    }); // DOMContentLoaded
    
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-57788588-1', 'auto');
    ga('send', 'pageview');
  </script>
</html>
